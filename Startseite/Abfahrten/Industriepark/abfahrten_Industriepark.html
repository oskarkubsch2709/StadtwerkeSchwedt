<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Abfahrtsanzeige Industriepark</title>
  <style>
     body {
     margin: 0;
     padding: 0;
     font-family: Arial, sans-serif;
   }

/* Grüner Balken als Container */
    .green-bar {
      width: 100%;
      background-color: #008b45;
      margin: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0px;
      color: white;
      font-weight: bold;
      font-size: 16px;
}


    /* Navigationsbereich */
    .nav-bar {
      width: 100%;
      display: flex;
      align-items: center;
      background-color: #f4f4f4;
      padding: 10px 40px;
    }

    .nav-bar img {
      height: 50px;
      width: auto;
      margin-right: 40px;
    }

    .nav-links {
      display: flex;
      flex: 1; /* nimmt gesamte restliche Breite ein */
      justify-content: center; /* zentriert Links */
      gap: 30px;
    }

    .nav-links a {
      text-decoration: none;
      color: #333;
      font-weight: bold;
      font-size: 16px;
    }

    .nav-links a:hover {
      color: #008b45;
    }

    h1 {
      margin: 20px 0;
      color: #008b45;
      margin-bottom: 4px; /* Abstand unterhalb der Überschrift */
      margin-left: 50px;
    }

    h2 {
      margin: 8px 0;
      color: #008b45;
      margin-top: 5px; /* Abstand oberhalb des Absatzes */
    }

   /* Lauftext-Balken */
   .ticker-container {
  width: 100%;
  background-color: #f4f4f4;   /* gleiche Farbe wie nav-bar */
  overflow: hidden;
  border-top: 2px solid #444;
  border-bottom: 2px solid #444;
  position: relative;
  height: 40px; /* Höhe für stabilen Lauftext */
}

.ticker-text {
  position: absolute;
  white-space: nowrap;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: bold;
  color: #333;
  animation: ticker linear infinite;
  animation-duration: var(--ticker-speed, 15s); /* Geschwindigkeit einstellbar */
}

/* Kontinuierlicher Lauftext von rechts nach links */
@keyframes ticker {
  0%   { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}

 .departure {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.2em;
      padding: 8px;
      border-bottom: 1px solid #ccc;
    }

    .line {
      font-weight: bold;
      background-color: #007bff;
      color: white;
      padding: 4px 10px;
      border-radius: 10px;
      margin-right: 30px;
      min-width: 40px;
      text-align: center;
    }

    .destination {
    flex: 1;
    min-width: 150px;
    }

    .platform {
    min-width: 50px;
    text-align: center;
    margin-right: 40px; /* Abstand zur Abfahrtszeit */
    font-family: Arial, sans-serif;
    }


    .countdown {
    font-family: Arial, sans-serif;
    min-width: 60px;
    text-align: right;
    }

    .departure.header {
    font-weight: bold;
    border-bottom: 2px solid black;
    background-color: #f0f0f0;
    }

    .table-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding: 8px 0;
    font-weight: bold;
    border-bottom: 2px solid black;
    font-family: Arial, sans-serif;
    }

    .table-header .header-cell {
    text-align: center; /* <-- hier liegt die Änderung */
    }

    /* Individuelle Breiten & Positionierung wie bei den Datenzeilen */
    .table-header .header-cell:nth-child(1) { min-width: 75px; margin-right: 30px; text-align: center; }
    .table-header .header-cell:nth-child(2) { flex: 1; min-width: 50px; text-align: center; }
    .table-header .header-cell:nth-child(3) { min-width: 50px; margin-right: 40px; text-align: center; }
    .table-header .header-cell:nth-child(4) { min-width: 60px; text-align: center; }
    .table-header .header-cell:nth-child(5) { min-width: 80px; text-align: center; }

   .line-1 {
  	background-color: #104E8B;
  	color: white;
	}

   .line-e1 {
	background-color: white;
	color: #104E8B;
	border: 2px solid #104E8B;
	}


   .info-panel {
	 white-space: pre-line;
 	 overflow: hidden;
 	 max-height: 0;
 	 opacity: 0;
 	 transition: all 0.5s ease;
 	 margin-left: 70px;
 	 margin-bottom: 5px;
 	 padding: 0 5px;
	}

    .info-panel.open {
	 opacity: 1;
 	 max-height: 500px; /* ausreichend hoch für deinen Inhalt */
 	 padding: 5px;
	}

    .delay {
 	min-width: 80px;
  	text-align: right;
  	font-weight: bold;
	}



@keyframes blink {
 	 0% { opacity: 1; }
 	 50% { opacity: 0; }
 	 100% { opacity: 1; }
	}

	.blinking {
	  animation: blink 1s infinite;
	}

  #infoText {
    margin-top: 20px;
    font-size: 1em;
    font-family: Arial, sans-serif;
  }

  #currentDateTime {
  position: absolute;
  top: 105px;
  right: 80px;
  font-family: Arial, sans-serif;
  font-size: 1em;
  }

.green-bar,
.nav-bar,
.ticker-container,
.table-header,
#departures,
#infoText {
  padding-left: 40px;
  padding-right: 40px;
  box-sizing: border-box;
}


</style>


  </style>
</head>
<body>

<!-- Grüner Balken mit Text -->
  <div class="green-bar bar-top">
    <div>Ein Unternehmen der Stadt Schwedt.</div>
    <div id="datetime"></div>
  </div>

  <!-- Inhaltsverzeichnis mit Logo + Links -->
  <div class="nav-bar">
    <!-- Logo -->
    <a href="../../../index.html">
     <img src="../../Logo.png" alt="Logo">
   </a>

    <!-- Links -->
    <div class="nav-links">
      <a href="../../Aktuelles/Aktuelles.html">Aktuelles</a>
      <a href="../../Fahrplan/Linienfahrplan.html">Linienfahrpläne und Netzplan</a>
      <a href="../Abfahrten.html">Abfahrtsanzeigen</a>
      <a href="../../Tickets/Tickets.html">Tickets / VBB</a>
      <a href="#">Über den ÖPNV in Schwedt</a>
    </div>
  </div>

   <!-- Lauftext -->
   <div class="ticker-container">
     <div class="ticker-text">
       Herzlich Willkommen bei den Stadtwerken Schwedt. Hier finden Sie alle wichtigen und aktuellen Informationen rund um Ihren Nahverkehr in Schwedt und Umgebung.
     </div>
   </div>


<h1>Abfahrten ab (H) Industriepark Sehna-Nord</h1>


   <div class="table-header">
  <div class="header-cell">Linie</div>
  <div class="header-cell">Ziel</div>
  <div class="header-cell">Steig</div>
  <div class="header-cell">Abfahrt</div>
  <div class="header-cell">Versp</div>
  </div>
  <div id="departures"></div>
  
  <div id="infoText">Weitere Informationen unter: www.stadtwerkeschwedt.de <br> <br> 
 	<img src="../Rollstuhl-Symbol.png" alt="Rollstuhl-Symbol.png" width="20">  Dieses Fahrzeug ist barrierefrei. </div>
  <div id="currentDateTime"></div>

<!-- Grüner Balken als Abschluss ganz unten -->
  <div class="green-bar bar-bottom">
<div>Ein Unternehmen der Stadt Schwedt.<br><br>Servicenummer: 03567 16966782</div> <br> <div>Öffnungszeiten Kundenzentrum Markt<br>Mo-Fr 08-18 Uhr<br>Sa 09-16 Uhr<br>So geschlossen</div>
</div>



  <script>
  // Fahrpläne für unterschiedliche Wochentage
  const weekdaySchedule = [
    { line: "1", destination: "Schwedter See / Hafen", time: "05:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "05:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "05:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "06:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "06:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "06:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "06:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "07:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "07:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "07:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "07:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "08:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "08:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "08:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "08:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "18:08", platform: "1"  },
    { line: "E1", destination: "Klingerweg, Betriebshof", time: "18:23", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "18:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "18:53", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "19:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "19:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "19:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "20:18", platform: "1"  },
    { line: "E1", destination: "Klingerweg, Betriebshof", time: "20:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "20:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "21:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "22:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "23:08", platform: "1"  }
  ];

  const saturdaySchedule = [
    { line: "1", destination: "Schwedter See / Hafen", time: "07:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "07:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "08:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "08:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "08:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "18:18", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "18:38", platform: "1"  },
    { line: "E1", destination: "Klingerweg, Betriebshof", time: "18:58", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "19:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "19:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "20:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "20:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "21:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "21:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "22:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "23:08", platform: "1"  }
];


    const sundaySchedule = [
    { line: "1", destination: "Schwedter See / Hafen", time: "09:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "09:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "10:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "11:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "12:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "13:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "14:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "15:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "16:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "17:48", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "18:08", platform: "1"  },
    { line: "E1", destination: "Klingerweg, Betriebshof", time: "18:28", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "18:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "19:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "19:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "20:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "20:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "21:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "21:38", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "22:08", platform: "1"  },
    { line: "1", destination: "Schwedter See / Hafen", time: "23:08", platform: "1"  }
];

function getScheduleForDate(date) {
  // Basis laut Feiertag/Wochentag
  let base;
  if (isPublicHoliday(date)) {
    base = sundaySchedule;
  } else {
    const dayIndex = date.getDay(); // 0=So, 6=Sa
    if (dayIndex === 6) base = saturdaySchedule;
    else if (dayIndex === 0) base = sundaySchedule;
    else base = weekdaySchedule;
  }

  // Einmalige Ergänzungen/Entfernungen
  const key = dateKey(date);
  const additions = SPECIAL_ADDITIONS[key] || [];
  const cancellations = SPECIAL_CANCELLATIONS[key] || [];

  if (cancellations.length) {
    base = base.filter(e =>
      !cancellations.some(c =>
        e.line === c.line &&
        e.time === c.time &&
        (c.destination ? e.destination === c.destination : true)
      )
    );
  }

  // Basis + Eventfahrten
  return [...base, ...additions];
}

// Lokaler Datumsschlüssel (ohne Zeitzonen-Überraschungen)
function dateKey(d) {
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return `${y}-${m}-${day}`;
}

// Einmalige Zusatzfahrten (pro Datum)
const SPECIAL_ADDITIONS = {
  // Beispiel: Eventverkehr am 5.9.2025
  "2025-10-14": []
};

// Einmalige Streichungen (kann leer bleiben, aber MUSS existieren)
const SPECIAL_CANCELLATIONS = {
  "2025-10-14": [ ]
};

/* Uhrzeit */
function updateDateTime() {
  const now = new Date();
  const options = { 
    year: 'numeric', 
    month: '2-digit', 
    day: '2-digit', 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
  };
  document.getElementById("datetime").textContent = 
    now.toLocaleDateString("de-DE", options);
}
updateDateTime();
setInterval(updateDateTime, 1000);


function generateDelay() {
  const rnd = Math.random();
  if (rnd < 0.70) return 0; // 70% pünktlich
  if (rnd < 0.95) return Math.floor(Math.random() * 3) + 1; // 1–3 Minuten
  return Math.floor(Math.random() * 5) + 4; // 4–8 Minuten
}

updateDateTime();
setInterval(updateDateTime, 1000);

// Hilfsfunktion zum Zeit-Parsing
function parseTimeToDate(dateBase, timeStr) {
  const [hour, minute] = timeStr.split(":").map(Number);
  return new Date(dateBase.getFullYear(), dateBase.getMonth(), dateBase.getDate(), hour, minute, 0);
}

function getInfoTextForLine(line) {
  switch(line) {
    case "1": return "Straßenbahnlinie 1";
    case "E1": return "Straßenbahnlinie E1 \n Fahrzeug verkehrt verkürzt bis (H) Klingerweg";
    default: return "Keine weiteren Informationen.";
  }
}

 
    // Globale Variable zum Speichern der Verspätungen
const delayCache = {};

function updateDepartures() {
  const now = new Date();
  const todayIndex = now.getDay();
  const todayBase = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const tomorrow = new Date(todayBase);
  tomorrow.setDate(tomorrow.getDate() + 1);
  const tomorrowIndex = tomorrow.getDay();

  // Persistent delays über window-Objekt
  window.departureDelays = window.departureDelays || new Map();

  const allDepartures = [
    ...getScheduleForDate(todayBase).map(entry => {
      const key = `${todayBase.toDateString()}_${entry.line}_${entry.time}`;
      if (!window.departureDelays.has(key)) {
        window.departureDelays.set(key, generateDelay());
      }
      const delay = window.departureDelays.get(key);
      return {
        ...entry,
        delay,
        departureTime: new Date(parseTimeToDate(todayBase, entry.time).getTime() + delay * 60000)
      };
    }),
    ...getScheduleForDate(tomorrow).map(entry => {
      const key = `${tomorrow.toDateString()}_${entry.line}_${entry.time}`;
      if (!window.departureDelays.has(key)) {
        window.departureDelays.set(key, generateDelay());
      }
      const delay = window.departureDelays.get(key);
      return {
        ...entry,
        delay,
        departureTime: new Date(parseTimeToDate(tomorrow, entry.time).getTime() + delay * 60000)
      };
    })
  ];

  const upcoming = allDepartures
    .filter(entry => entry.departureTime > now)
    .sort((a, b) => a.departureTime - b.departureTime)
    .slice(0, 6); // nur die nächsten 6

  const container = document.getElementById("departures");
  container.innerHTML = "";

  upcoming.forEach(entry => {
    const row = document.createElement("div");
    row.className = "departure";

    const line = document.createElement("div");
    if (entry.line === "1") {
      line.className = "line line-1";
    } else if (entry.line === "E1") {
      line.className = "line line-e1";
    } else {
      line.className = "line";
    }
    line.textContent = entry.line;

    const dest = document.createElement("div");
    dest.className = "destination";
    dest.textContent = entry.destination;

    if (Math.random() < 0.7) {
      const wheelchair = document.createElement("img");
      wheelchair.src = "../Rollstuhl-Symbol.png";
      wheelchair.alt = "Rollstuhl-Symbol";
      wheelchair.style.width = "20px";
      wheelchair.style.marginLeft = "5px";
      dest.appendChild(wheelchair);
    }

    const platform = document.createElement("div");
    platform.className = "platform";
    platform.textContent = entry.platform || "-";

    const delay = document.createElement("div");
    delay.className = "delay";
    delay.innerHTML = entry.delay > 0
      ? `<span style="color:red">+${entry.delay}</span>`
      : "";

    const diffMs = entry.departureTime - now;
    const diffMin = Math.round(diffMs / 60000);

    const countdown = document.createElement("div");
    countdown.className = "countdown";

    if (diffMs >= 0 && diffMs < 60000) {
      countdown.textContent = "jetzt";
      countdown.classList.add("blinking");
    } else if (diffMin < 60) {
      countdown.textContent = `${diffMin} min`;
      countdown.classList.remove("blinking");
    } else {
      const h = entry.departureTime.getHours().toString().padStart(2, '0');
      const m = entry.departureTime.getMinutes().toString().padStart(2, '0');
      countdown.textContent = `${h}:${m}`;
      countdown.classList.remove("blinking");
    }

    row.appendChild(line);
    row.appendChild(dest);
    row.appendChild(platform);
    row.appendChild(countdown);
    row.appendChild(delay);
    container.appendChild(row);

    const infoPanel = document.createElement("div");
    infoPanel.className = "info-panel";

    // Zeit aus entry.time nehmen (das ist die geplante Zeit ohne Verspätung)
    const [hour, minute] = entry.time.split(":");
    const formattedTime = `${hour.padStart(2, '0')}:${minute.padStart(2, '0')}`;

    // Baue den Info-Text mit Zeit + Linieninfo
    let infoText = `Geplante Abfahrt: ${formattedTime} Uhr`;

    if (entry.delay > 0) {
    const delayedH = entry.departureTime.getHours().toString().padStart(2, '0');
    const delayedM = entry.departureTime.getMinutes().toString().padStart(2, '0');
    infoText += ` | heute: ${delayedH}:${delayedM}, +${entry.delay}`;
    }

    infoText += `\n\n${getInfoTextForLine(entry.line)}`;
    infoPanel.textContent = infoText;
    container.appendChild(infoPanel);

    row.addEventListener("click", () => {
      infoPanel.classList.toggle("open");
    });
  });
}


//FEIERTAGE IN BRANDENBURG

function isPublicHoliday(date) {
  const year = date.getFullYear();
  const month = date.getMonth();
  const day = date.getDate();

  // feste Feiertage Brandenburg
  const fixedHolidays = [
    [0, 1],   // Neujahr
    [4, 1],   // Tag der Arbeit
    [9, 3],   // Tag der Deutschen Einheit
    [9, 31],  // Reformationstag
    [11, 25], // 1. Weihnachtstag
    [11, 26], // 2. Weihnachtstag
  ];

  // Osterberechnung (Computus)
  function getEasterSunday(y) {
    const f = Math.floor,
      G = y % 19,
      C = f(y / 100),
      H = (C - f(C / 4) - f((8 * C + 13) / 25) + 19 * G + 15) % 30,
      I = H - f(H / 28) * (1 - f(29 / (H + 1)) * f((21 - G) / 11)),
      J = (y + f(y / 4) + I + 2 - C + f(C / 4)) % 7,
      L = I - J,
      month = 3 + f((L + 40) / 44),
      day = L + 28 - 31 * f(month / 4);
    return new Date(y, month - 1, day);
  }

  const easter = getEasterSunday(year);
  const holidays = fixedHolidays.map(([m, d]) => new Date(year, m, d));

  // Bewegliche Feiertage
  holidays.push(new Date(easter.getFullYear(), easter.getMonth(), easter.getDate() - 2)); // Karfreitag
  holidays.push(new Date(easter.getFullYear(), easter.getMonth(), easter.getDate() + 1)); // Ostermontag
  holidays.push(new Date(easter.getFullYear(), easter.getMonth(), easter.getDate() + 39)); // Christi Himmelfahrt
  holidays.push(new Date(easter.getFullYear(), easter.getMonth(), easter.getDate() + 50)); // Pfingstmontag

  return holidays.some(h =>
    h.getDate() === day &&
    h.getMonth() === month &&
    h.getFullYear() === year
  );
}


	function generateDelay() {
  const rnd = Math.random();
  if (rnd < 0.70) return 0;
  if (rnd < 0.95) return Math.floor(Math.random() * 3) + 1;
  return Math.floor(Math.random() * 5) + 4;
}

    updateDepartures();
    setInterval(updateDepartures, 60 * 1000);


  </script>
</body>
</html>
